{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/inventory.css' %}">
{% endblock %}

{% block content %}
<div class="small-logo">
    <img class="logo" src={% static 'svg/book-cycle-logo.svg' %} alt="book cycle logo" width="10" height="6">
</div>
<main>
    <div class="books-background">
        <div class="filter-sort-search-box">
            <form id="search-form" method="GET" action="{% url 'books' %}">
                <div class="filter-sort-input">
                    <label for="search-input">Search term: </label>
                    <input id="search-input" class="filter-select filter-search" type="text" name="search" placeholder="-----" 
                    value="{{ search_term|default:'' }}"
                    >
                </div>
                <div class="filter-sort-input">
                    <label for="filter-subject">Filter by Subject:  </label>
                    <select name="subject" id="filter-subject" class="filter-select filter-subject">
                        <option value="None">-----</option>
                        {% for s in all_subjects %}
                            <option value="{{ s.name }}"
                            {% if subject == s.name %}
                            selected
                            {% endif %}
                            >{{ s.friendly_name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-sort-input">
                    <label for="filter-yeargroup">Filter by Year Group:  </label>
                    <select name="year_group" id="filter-yeargroup" class="filter-select filter-yeargroup">
                        <option value="None">-----</option>
                        {% for yg in all_year_groups %}
                        <option value="{{ yg.name }}"
                        {% if year_group == yg.name %}
                            selected
                            {% endif %}
                        >{{ yg.friendly_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- <div class="filter-sort-input">
                    <label for="filter-subject">Sort by:  </label>
                    <select name="sort" id="sort" class="filter-select sort">
                        <option value="title_a_z" selected>Title - A-Z</option>
                        <option value="title_z_a">Title - Z-A</option>
                        <option value="price">Price - Low-High</option>
                        <option value="subject_a_z">Subject - A-Z</option>
                    </select>
                </div> -->
                <div class="filter-sort-input">
                    <button class="search-clear">Clear All</button>
                    <button class="search-submit" type="submit">Search</button>
                </div>
            </form>
        </div>
        {% if books.count == 0 %}
            <h1 class="no-results">No results found.</h1>
        {% endif %}
        <div class="gallery">
            {% for book in books %}
                <article class="bookFrame">
                    <a href="{{ book.get_slug_url}}" class="book-image-box">
                        {% if book.image %}
                            <img class="book-image" src="/media/{{ book.image }}">
                        {% else %}
                            <img class="book-image" src="/media/noimage.png">
                        {% endif %}
                    </a>
                    <div class="book-details-box">
                        <h2 class="book-title">{{ book.title }}</h2>
                        {% if not book.in_stock %}
                        <p class="out-of-stock">X Out of stock</p>
                        {% else %}
                            <div>
                            <p class="cheapest">Our lowest price:</p>
                            <p class="book-price">Â£{{ book.get_cheapest_stock.price }}</p>
                            <p class="book-condition">(Condition: <strong>{{ book.get_cheapest_stock.condition }})</strong></p>
                            </div>
                        {% endif %}
                        
                        <p class="book-year-group">Year Group: <strong>{{ book.year_group.friendly_name }}</strong></p>
                        <p class="book-subject">Subject: <strong>{{ book.subject.friendly_name }}</strong></p>
                        <a class="more-details" href="{{ book.get_slug_url }}">More Options and Details</a>
                        <button class="add-button">Add</button>
                    </div>
                </article>
            {% endfor %}
        </div>
    </div>
</main>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
    <script src="{% static 'js/books.js' %}" type="module"></script>
{% endblock %}